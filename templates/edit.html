{% extends "layout.html" %}
{% block title %}
{{ session.profile.name }}'s dashboard | Student Profile Viewer
{% endblock %}

{% block content %}
<div class="container">
    <h1>Edit Profile</h1>
  	<hr>
    <div class="row">
        <form action="{{ url_for('edit_dashboard') }}" autocomplete="off" method="POST" enctype="multipart/form-data">
            <div class="col-md-3">
                <div class="text-center">
                    <img  id="profile_img_edit" src="{{ session.profile.picture }}" class="img-circle img-responsive" style="overflow: hidden;" alt="Profile Picture">
                </div>
                <br>
                <p>Upload a different Profile Picture:</p>
                <input name="picture" type="file" id="upload_image" accept="image/*" onchange="loadFile(event)" class="form-control"/>
                <script>
                    var loadFile = function(event) {
                      var output = document.getElementById('profile_img_edit');
                      output.src = URL.createObjectURL(event.target.files[0]);
                    };
                </script>
            </div>

            <div class="col-md-9 edit-profile-row">
                <label class="col-lg-3 control-label">Profile Overview:</label>
                <div class="col-lg-8">
                    <textarea name="description" onkeyup="textCounter(this,'desc_chars_left',150);" id="description" class="form-control" rows="3" cols="30" maxlength="150">{{ user.description if user.description is not none }}</textarea>
                    <p id="desc_chars_left"></p>
                </div>
            </div>
            <div class="col-md-9 edit-profile-row">
                <label class="col-lg-3 control-label">Given Name:</label>
                <div class="col-lg-8">
                    <input name="given_name_editable" id="given_name" class="form-control" type="text" value="{{ user.given_name_normalized }}">
                </div>
            </div>
            <div class="col-md-9 edit-profile-row">
                <label class="col-lg-3 control-label">Family Name:</label>
                <div class="col-lg-8">
                    <input name="family_name_editable" id="family_name" class="form-control" type="text" value="{{ user.family_name_normalized }}">
                </div>
            </div>
            <div class="col-md-9 edit-profile-row">
                <label class="col-lg-3 control-label">Skills:</label>
                <button type="button" onclick="add_skill_handler()" id="add_skills_button" class="btn btn-primary">Add</button>
                <div class="autocomplete col-lg-8">
                    <input style="float: right;" id="skills_text_input" class="form-control" type="text" placeholder="Skill">
                    <br>
                </div>
                {% for skill in user.skills %}
                <button id="{{ skill }}skills_added" class="displayed_skills col-sm-3" type="button" onclick="remove_skill(this)">
                    <div class="displayed_skills_text">{{ skill }}<input type="hidden" name="skills[]" value="{{ skill }}">
                    </div>
                </button>
                {% endfor %}
            </div>
            <div class="col-md-9 edit-profile-row">
                <label class="col-lg-3 control-label">Awards:</label>
                <button type="button" onclick="add_award_handler()" id="add_award_button" class="btn btn-primary">Add</button>
            </div>
            <br>
            <input type="submit" value="Submit" class="btn btn-primary btn-large">
        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='js/text_counter.js') }}"></script>
<script src="{{ url_for('static', filename='js/autocomplete.js') }}"></script>
<script src="{{ url_for('static', filename='js/add_skill.js') }}"></script>
<script src="{{ url_for('static', filename='js/add_award.js') }}"></script>
<script>
    var skills = {{ skills | tojson }};
    autocomplete(document.getElementById("skills_text_input"), skills);

    var num_awards = 0;
    function add_award_handler(){
        num_awards += 1;
        add_award(document.getElementById("add_award_button"), num_awards);
    }

    function add_skill_handler(){
        add_skill(document.getElementById("skills_text_input"), skills);
    }
</script>

{% endblock %}